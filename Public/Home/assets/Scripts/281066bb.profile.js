(function(){define("lib/user",[],function(){return{isLogin:function(){return typeof window.ukey=="undefined"&&(ukey=!1),ukey?!0:!1},toLogin:function(e){document.location.href=e}}}),define("lib/G",[],function(){"use strict";var e=!!document.all&&navigator.userAgent.indexOf("Opera")===-1,t=e&&!("maxHeight"in document.body.style),n=e&&"prototype"in Image,r=e&&!t&&!n,i=window,s=i.document,o={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"};return{ua:{isIE:e,isIE6:t,isIE8:n,isIE7:r,isFF:!!s.getBoxObjectFor||"mozInnerScreenX"in i,isOP:!!i.opera&&!!i.opera.toString().indexOf("Opera"),isOP9:/^function \(/.test([].sort),isWK:!!i.devicePixelRatio,isCR:/s/.test(/a/.toString),isIpad:/iPad/.test(navigator.userAgent),isIphone:/iPhone/.test(navigator.userAgent)},isHtml:function(e){var t=/^[^<]*(<[\w\W]+>)[^>]*$/;return t.test(e)},format:function(e,t,n){if(typeof t=="string"){var r=n?t:"{v}",i=n||t;return e.replace(r,""+i)}var s=t,i;return e.replace(/\{([^{}]+)\}/g,function(e,t){return i=s[t],i!==undefined?""+i:""})},each:function(e,t,n){var r,i,s,o=Array.prototype.forEach,u=Object.prototype.hasOwnProperty;n=n||this;if(e==null)return;if(o&&e.forEach===o)e.forEach(t,n);else if(e instanceof Array)for(i=0,s=e.length;i<s;i++)t.call(n,e[i],i,e);else for(var a in e)u.call(e,a)&&t.call(n,e[a],a,e)},scriptOnload:function(e,t){window.addEventListener?(e.addEventListener("load",t,!1),e.addEventListener("error",function(){t()},!1)):e.attachEvent("onreadystatechange",function(){var n=e.readyState;(n==="loaded"||n==="complete")&&t()})},loadScript:function(e,t){var n=s.createElement("script"),r=this.loadScript.head=this.loadScript.head||s.getElementsByTagName("head")[0];return this.scriptOnload(n,function(){t&&t.call(n);try{if(n.clearAttributes)n.clearAttributes();else for(var e in n)delete n[e]}catch(i){}r.removeChild(n)}),n.async=!0,n.src=e,r.insertBefore(n,r.firstChild)},type:function(e){return e==null?String(e):o[Object.prototype.toString.call(e)]||"object"},isFun:function(e){return this.type(e)==="function"}}}),define("lib/support",["lib/G"],function(e){"use strict";var t=" -webkit- -moz- -o- -ms- -khtml- ".split(" "),n="Webkit Moz O ms Khtml".split(" "),r=document.createElement("div");return{fixed:function i(){if(typeof i.r!="undefined")return i.r;var t=!0;if(e.ua.isIpad||e.ua.isIphone)t=navigator.userAgent.match(/[5-9]_[0-9]/)!==null;else{var n=document.createElement("div"),r=document.createElement("div");n.style.position="absolute",n.style.top="200px",r.style.position="fixed",r.style.top="100px",n.appendChild(r),document.body.appendChild(n),r.getBoundingClientRect&&r.getBoundingClientRect().top==n.getBoundingClientRect().top&&(t=!1),document.body.removeChild(n),n=null,r=null}return i.r=t,t},touchEvent:function s(){if(typeof s.r!="undefined")return s.r;var e=!0,t=["touchstart","touchmove","touchend","touchcancel"];for(var n=0,i=t.length;n<i;n++){var o=t[n];o="on"+o;var u=o in r;u||(r.setAttribute(o,"return;"),u=typeof r[o]=="function");if(!u){e=!1;break}}return s.r=e,e},cssanimation:function o(){if(typeof o.r!="undefined")return o.r;var e=!1,t=r.style,i="animationName",s=i.charAt(0).toUpperCase()+i.substr(1),u=(i+" "+n.join(s+" ")+s).split(" ");for(var a in u)if(t[u[a]]!==undefined){e=!0;break}return o.r=e,e}}}),define("lib/Base",[],function(){"use strict";var e=function(){};return e.extend=function(e,t){var n=t||this;for(var r in n)n.hasOwnProperty(r)&&r!=="prototype"&&(e[r]=n[r]);for(var i in n.prototype)n.prototype.hasOwnProperty(i)&&(e.prototype[i]=n.prototype[i])},e}),define("lib/Event",["lib/Base"],function(e){"use strict";function o(){}var t=Array.prototype.slice,n=Object.prototype.toString,r=function(e){return typeof e=="object"?e===null?"null":/\[object (\w+)\]/.exec(n.call(e))[1].toLowerCase():typeof e},i=function(e,t,n){var i,s,o,u=Array.prototype.forEach;n=n||this;if(e==null)return;if(u&&e.forEach===u)e.forEach(t,n);else if(r(e)==="array")for(s=0,o=e.length;s<o;s++)t.call(n,e[s],s,e);else for(var a in e)ObjectProto.hasOwnProperty.call(e,a)&&t.call(n,e[a],a,e)},s=function(e,t,n){var i,s,o,u,a=Array.prototype.filter;n=n||this;if(e==null)return;if(a&&e.filter===a)return e.filter(t,n);if(r(e)==="array"){u=[];for(s=0,o=e.length;s<o;s++)t.call(n,e[s],s,e)&&u.push(e[s])}else{u={};for(var f in e)ObjectProto.hasOwnProperty.call(e,f)&&t.call(n,e[f],f,e)&&(u[f]=e[f])}return u};return o.prototype.on=function(e,t,n,r){return this.eventQueue=this.eventQueue||{},this.eventQueue[e]=this.eventQueue[e]||[],this.eventQueue[e].push({callback:t,context:n,once:r}),this},o.prototype.off=function(e,t){this.eventQueue=this.eventQueue||{};if(this.eventQueue[e]==null)return;return t?(this.eventQueue[e]=s(this.eventQueue[e],function(e,n){return e.callback!==t}),this.eventQueue[e].length===0&&delete this.eventQueue[e]):delete this.eventQueue[e],this},o.prototype.fire=function(e,n){this.eventQueue=this.eventQueue||{};var r=this.eventQueue[e],s=!0;if(r){var o=t.call(arguments,1);i(r,function(t){t.callback.apply(t.context,o)===!1&&(s=!1),t.once&&this.off(e,t.callback)},this)}return s},e.extend(o),o}),define("lib/Overlay",["lib/support","lib/Event","lib/G"],function(e,t,n){"use strict";function y(e){var t,n;e?(t=(u.height()-h.height())/2+(document.documentElement.scrollTop||window.pageYOffset||0),n=(u.width()-h.width())/2+(document.documentElement.scrollLeft||window.pageXOffset||0)):(t=(u.height()-h.height())/2,n=(u.width()-h.width())/2),h.css({top:t,left:n})}function b(e,t){v&&v.length&&v.css({opacity:e||.5,"background-color":t||"#000"}).show()}function w(){v&&v.length&&v.hide()}function E(){v.css({top:document.documentElement.scrollTop||window.pageYOffset||0,left:document.documentElement.scrollLeft||window.pageXOffset||0})}function S(){v.css({width:u.width(),height:u.height()})}function x(){n.ua.isIE6&&v&&v.length&&(v.css({position:"absolute",bottom:"auto",right:"auto"}),S(),E())}function T(t){if(T.inited)return;T.inited=!0,i=t||"gui",s='<div id="blockWindow" class="'+i+'-block">                           <div class="'+i+'-block-b">                               <h4 class="'+i+'-block-hd">                                   <span id="blockTitle"></span>                                   <a class="blockClose '+i+'-block-close" href="#" title="关闭">X</a>                               </h4>                               <div id="blockContent" class="'+i+'-block-bd"></div>                           </div>                       </div>',h=$(s),h.appendTo("body"),p=$(a),d=$(f),g=[h,p],navigator.userAgent.match(/iPad|iPhone/i)!==null?c=navigator.userAgent.match(/[5-9]_[0-9]/)!==null:(c=e.fixed(),u.resize(function(){m&&m.pos()})),n.ua.isIE6&&u.resize(function(){v&&v.length&&m&&S()}).scroll(function(){v&&v.length&&m&&E()}),h.delegate(l,"click",function(e){e.preventDefault(),m&&m.close()})}function N(e,t,n,r){this._isOpen=!1,T.call(this,r),this._fixed=c,this._coverNeedShowed=!1,this._initedCover=!1,e&&!r&&this.open(e,t,n)}var r=0,i,s='<div id="blockWindow" class="gui-block">                           <div class="gui-block-b">                               <h4 class="gui-block-hd">                                   <span id="blockTitle"></span>                                   <a class="blockClose gui-block-close" href="#" title="关闭">X</a>                               </h4>                               <div id="blockContent" class="gui-block-bd"></div>                           </div>                       </div>',o='<iframe src="{v}" id="blockIframe" frameborder="0" width="100%"></iframe>',u=$(window),a="#blockContent",f="#blockTitle",l=".blockClose",c,h,p,d,v,m,g;return N.prototype={openCallBack:function(e){return e&&this.on("open",e,this),this},closeCallBack:function(e){return e&&this.on("close",e,this),this},afterClose:function(e){return e&&this.on("afterClose",e,this),this},afterOpen:function(e){return e&&this.on("afterOpen",e,this),this},isOpen:function(){return this._isOpen},close:function(){return this._isOpen?this.fire("close",g)?(h.hide(),this._isOpen=!1,m=null,this.fire("afterClose",g),this):this:this},open:function(e,t,r){return this.fire("open",g)?(m&&m!==this&&m.close(),m=this,this.undelegate(),t&&this.delegate(t),e&&!n.isHtml(e)&&(e=n.format(o,e)),p.html(e||""),this._title&&d.html(this._title),this._width&&h.width(this._width),h.css("position",!this._fixed||!c?"absolute":"fixed"),this.pos(),h.show(),this._isOpen=!0,r&&r.call(this,p),this.fire("afterOpen",g),this):this},delegate:function(e){if(!e.length){p.delegate(e.selector,e.event,e.func);return}return n.each(e,function(e){this.delegate(e.selector,e.event,e.func)},p),this},undelegate:function(){return p.undelegate(),this},pos:function(){return y(!this._fixed||!c),n.ua.isIE6&&this._cover&&this._cover.length&&this._cover.css(),this},title:function(e){return this._title=e,this._isOpen&&d.html(e),this},width:function(e){return this._width=e,this._isOpen&&(h.width(e),this.pos()),this},pin:function(){if(this._fixed||!c)return;return this._fixed=!0,this._isOpen&&(h.css("position","fixed"),this.pos()),this},unpin:function(){if(!this._fixed)return;return this._fixed=!1,this._isOpen&&(h.css("position","absolute"),this.pos()),this},showCover:function(e,t){if(!v||!v.length)v=$('<div style="position:fixed;top:0;left:0;right:0;bottom:0;display:none;z-index:'+((parseInt(h.css("z-index"),10)||0)-1)+';"></div>').appendTo("body"),x();if(!this._initedCover){var n=this;this.on("afterClose",function(){n._coverNeedShowed&&w()}).on("afterOpen",function(){n._coverNeedShowed&&b(n._coverOpacity,n._coverColor)}),this._initedCover=!0}return typeof e=="string"&&(t=e,e=null),e&&(this._coverOpacity=e),t&&(this._coverColor=t),b(e||this._coverOpacity,t||this._coverColor),this._coverNeedShowed=!0,this},hideCover:function(){return w(),this._coverNeedShowed=!1,this}},t.extend(N),N}),define("lib/tmpl",[],function(){function e(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}var t={entities:e};return function(n,r){/\W/.test(n)||(n=document.getElementById(n).innerHTML);var i=new Function("funcs, obj","var p=[],print=function(){p.push.apply(p,arguments);};with(funcs){with(obj){p.push('"+n.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',entities($1),'").replace(/\t:=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}}return p.join('');");return r?i(t,r):function(e){return i(t,e)}}}),define("lib/report",["lib/Overlay","lib/tmpl"],function(e,t){function r(){var e=$("#reportReasons").find(":checked").next(),t=e.next(),n=t.length?t.val():e.text();return n}function i(e,t,i,s,o,u){function a(i){i.preventDefault();var s=r();if(!s){alert("请填写举报理由");return}if(s.length<2){alert("多写几个字又不会怀孕");return}if(s.length>140){alert("删除理由不能超过100个字");return}o(e,s,t,function(){n.close(),u()})}n.open(s,[{event:"click",selector:"#reportSure",func:a},{event:"click",selector:"#reportCancel",func:function(e){e.preventDefault(),n.close()}}]),n.title(i)}function u(e,n,r){if(e.attr("data-report")!="yes")return;var u=e.attr("data-url"),a=e.attr("data-type"),f=e.attr("data-title"),l=e.attr("data-img"),c={},h={url:u,type:a,img:l,title:f};e.attr("data-reply_id")&&(c.reply_id=e.attr("data-reply_id"));var p=t(s,h),d="举报"+a;i(u,c,d,p,o.reportAdmin,function(){e.text("举报成功"),e.attr("data-report","no")})}var n=new e,s='<div class="block-report-content">                         <% if (img) { %>                         <img src="<%=img%>" width="48" height="48"/>                         <% } %>                         <% if (title) { %>                             <a href="<%=url%>" target="_blank"><%=title%></a>                         <% } %>                     </div>                     <div class="block-report-reasons">                         <h5>举报理由：</h5>                         <ul id="reportReasons">                             <li><input type="radio" id="reason1" name="reason" /><label for="reason1">垃圾广告</label></li>                             <li><input type="radio" id="reason2" name="reason"/><label for="reason2">敏感或淫秽色情信息</label></li>                             <li><input type="radio" id="reason3" name="reason"/><label for="reason3">人身攻击</label></li>                             <li><input type="radio" id="reason4" name="reason"/><label for="reason4">内容涉及抄袭及版权问题</label></li>                             <li class="block-report-reasons-o"><input type="radio" id="reason5" name="reason"/><label for="reason5">其他理由</label><input type="text" class="block-report-reasons-txt"/></li>                         </ul>                     </div>                     <div class="block-report-do">                         <a href="#" id="reportSure">提交</a><a href="#" id="reportCancel">取消</a>                     </div>',o={reportAdmin:function(e,t,n,r){var i=$.extend({url:e,reason:t},n);$.post("/apis/censor/report.json",i,r)}};return u}),require(["lib/user","lib/report"],function(e,t){"use strict";var n={login:function(){function e(e,t){$.ajax({url:"/apis/community/relationship/follow.json",data:{ukey_following:e},type:t,success:function(e){t==="post"?$("#focusUser").addClass("btn-default").removeClass("btn-primary").attr("data-operation","unfollow").text("已关注"):$("#focusUser").addClass("btn-primary").removeClass("btn-default").attr("data-operation","follow").text("+关注")},error:function(e){var t=$.parseJSON(e.responseText);t.error_code=="201017"&&alert("您已被此用户拉黑，禁止添加关注。")},dataType:"json"})}function n(e,t){var n;t==="add"?n="POST":t==="remove"&&(n="DELETE"),$.ajax({url:"/apis/community/relationship/black.json",type:n,data:{ukey_blocked:e},success:function(e){var t=$("#addBlacklist");n==="POST"?t.data("action","remove").text("移出黑名单"):n==="DELETE"&&t.data("action","add").text("加入黑名单")},error:function(){},dataType:"json"})}$("#focusUser").click(function(){var t=$(this),n=t.attr("data-ukey"),r=t.attr("data-operation"),i=r==="follow"?"post":"delete";e(n,i)}),$("#reportUser").click(function(){t($(this))}),$("#addBlacklist").click(function(){var e=$(this),t=e.data("ukey"),r=e.data("action");if(r==="add"){var i=window.confirm("确定要将该用户加入黑名单？加入黑名单后，关注关系将自动解除，对方不能给你发站内信、评论你的日志和小组贴、「@」你，邀请你回答问题，但仍然可以查看你的公开信息。");i&&n(t,r)}else n(t,r)}),$(".join-list").length&&($(".join-list").delegate(".focus-btn","mouseenter",function(){var e=$(this);e.removeClass("focus-btn").addClass("gnbtn-frame").html('<span class="gnicon-cancel"></span>取消')}),$(".join-list").delegate(".gnbtn-frame","mouseleave",function(){var e=$(this);e.removeClass("gnbtn-frame").addClass("focus-btn").html('<span class="gnicon-tick"></span>已关注')}),$(".join-list").delegate("a[data-operation]","click",function(){var e=$(this),t=e.data("operation"),n=e.data("id"),r={follow:'<a class="focus-btn follow-btn" href="javascript: void 0;" data-id="'+n+'" data-operation="unfollow"><span class="gnicon-tick"></span>已关注</a>',unfollow:'<a class="gnbtn-plat follow-btn" href="javascript:void 0;" data-id="'+n+'" data-operation="follow"><span>+</span>关注</a>'};$.ajax({url:"/apis/ask/tag_follower.json",data:{tag_name:n},type:t=="follow"?"post":"delete",success:function(n){n.ok&&e.replaceWith(r[t])},dataType:"json"})}))},all:function(){},unlogin:function(){}},r=e.isLogin()?"login":"unlogin";n[r]&&n[r](ukey),n.all&&n.all()}),define("profile",function(){})})();