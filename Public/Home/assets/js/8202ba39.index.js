(function(){define("lib/user",[],function(){return{isLogin:function(){return typeof window.ukey=="undefined"&&(ukey=!1),ukey?!0:!1},toLogin:function(e){document.location.href=e}}}),function(){function n(e){this.message=e}var e=typeof exports!="undefined"?exports:this,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.prototype=new Error,n.prototype.name="InvalidCharacterError",e.btoa||(e.btoa=function(e){var r=String(e);for(var i,s,o=0,u=t,a="";r.charAt(o|0)||(u="=",o%1);a+=u.charAt(63&i>>8-o%1*8)){s=r.charCodeAt(o+=.75);if(s>255)throw new n("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");i=i<<8|s}return a}),e.atob||(e.atob=function(e){var r=String(e).replace(/=+$/,"");if(r.length%4==1)throw new n("'atob' failed: The string to be decoded is not correctly encoded.");for(var i=0,s,o,u=0,a="";o=r.charAt(u++);~o&&(s=i%4?s*64+o:o,i++%4)?a+=String.fromCharCode(255&s>>(-2*i&6)):0)o=t.indexOf(o);return a})}(),define("Base64",function(){}),function(e){"use strict";function a(e){var t=0,n;for(n=0;n<e.length;n++)t=e.charCodeAt(n)+(t<<6)+(t<<16)-t<<0;return t}function f(){return e.devicePixelRatio||1}function l(e,t,n,r){var i,s,o,u="",f=e.length;t=t.replace(/^\/+/,""),f>1?(s=a(t)%f,s<0&&(s+=3),o=e[s]):o=e[0],i="http://"+o+"/"+encodeURI(t);if(n&&r)u+="/1";else if(n||r)u+="/3";return n&&(u+="/w/"+n),r&&(u+="/h/"+r),u!==""&&(i=i+"?imageView2"+u),i}function c(e){return e.indexOf("dev.guokr.com")>0}function h(e,t,n){var s,a,f,h,p=r.createElement("a"),d=c(e)?o:u;p.href=e,h=p.pathname;if(h.indexOf("/image/")===0)h=h.slice(7);else if(h.indexOf("image/")===0)h=h.slice(6);else if(h.indexOf("/thumbnail/")===0||h.indexOf("thumbnail/")===0)f=e.replace(i,"$2"),s=f.slice(-2),a={dJ:".gif",pQ:".jpg",BO:".png"}[s],h=f+a;return l(d,h,t,n)}function p(e,t,r){var o={src:e,width:null,height:null,"data-hashkey":null,"data-orig-width":null,"data-orig-height":null};if(!i.test(e))return s.test(e)&&(o.src=h(e)),o;o.src=e=h(e);var u=f(),a=e.replace(i,"$2"),l=n(a.replace(/_/g,"/").replace(/-/g,"+")),c=l.charCodeAt(32)+l.charCodeAt(33)*256+l.charCodeAt(34)*65536+l.charCodeAt(35)*16777216,p=l.charCodeAt(36)+l.charCodeAt(37)*256+l.charCodeAt(38)*65536+l.charCodeAt(39)*16777216;o["data-hashkey"]=a,o["data-orig-width"]=c,o["data-orig-height"]=p;if(t===undefined&&r>0)t=r*c/p;else if(r===undefined&&t>0)r=t*p/c;else if(t<1||r<1)return o;if(c<t*u||p<r*u)u=1,c>t&&p>r?u=Math.min(c/t,p/r):(t=c>t?t:c,r=p>r?r:p);o.width=Math.round(t),o.height=Math.round(r),t=Math.round(t*u),r=Math.round(r*u);if(Math.abs(c-t)>1||Math.abs(p-r)>1)o.src=h(e,t,r);return o}function d(e){if(i.test(e)||s.test(e))e=h(e);return e}var t,n=e.atob||require("Base64").atob,r=e.document||require("jsdom").jsdom(),i=/^http:\/\/(img1\.(?:\w+\.)?guokr\.com(?:\:\d+)?\/(?:image|thumbnail)|\d+\.im(?:\.dev)?\.guokr\.com(?:\:\d+)?)\/([\w-]{56})(?:_\d*x\d*)?\.(jpg|png|gif)(\?.*|$)/,s=/^(http:\/\/(?:\w+\.)*guokr\.com(?:\:\d+)?)?(\/gkimage\/[a-z0-9\/]{15}\.(gif|jpe?g|png))(\?.*|$)/,o=["1.im.dev.guokr.com","2.im.dev.guokr.com","3.im.dev.guokr.com"],u=["1.im.guokr.com","2.im.guokr.com","3.im.guokr.com"];t={sdbm:a,thumbnail:p,original:d,public_url:h},typeof define=="function"&&define.amd?define("lib/gkimage",["Base64"],function(){return t}):typeof e!="undefined"?(typeof module!="undefined"&&module.exports&&(e=module.exports=t),e.gkimage=t):window.gkimage=t}(typeof exports=="object"&&exports||this),define("lib/tmpl",[],function(){function e(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}var t={entities:e};return function(n,r){/\W/.test(n)||(n=document.getElementById(n).innerHTML);var i=new Function("funcs, obj","var p=[],print=function(){p.push.apply(p,arguments);};with(funcs){with(obj){p.push('"+n.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',entities($1),'").replace(/\t:=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}}return p.join('');");return r?i(t,r):function(e){return i(t,e)}}}),define("lib/postList",["lib/gkimage","lib/tmpl"],function(e,t){function n(n){var r=n,i=r.attr("style").match(/\((.*)\)/g)[0].replace("(",""),s=e.thumbnail(i,450),o='<div class="title-img-wrap">                            <div class="title-img-operate">                                <a href="javascript:void 0;" class="img-zoom-out"><span class="icon-contract"></span>收起</a>                                <span class="split">|</span>                                <a href="<%= originUrl %>" target="_blank"><span class="icon-expand"></span>查看大图</a>                            </div>                            <img src="<%= largeUrl %>">                        </div>',u=r.parents(".title-content").find(".title-link").attr("href")+"gallery/#"+s["data-hashkey"],a=$(t(o,{originUrl:u,largeUrl:s.src}));r.parent(".title-imgs").addClass("title-imgs-zoom").append(a),a.find(".img-zoom-out, img").click(function(e){e.preventDefault(),$(window).scrollTop()>a.find("img").offset().top&&$(window).scrollTop(a.parents("li").offset().top-$(".gheader-wrap").height()),a.parent().removeClass("title-imgs-zoom"),a.remove()})}function r(e){var n=e,r=n.hasClass("title-liked")?"DELETE":"POST",i=n.attr("data-post_id");$.ajax({url:"/apis/group/post_liking.json",type:r,data:{post_id:i},success:function(e){var r=n.find(".like-num");if(n.hasClass("title-liked")){var i=$(t('<span class="like-fade">-1</span>',{}));n.append(i),i.animate({top:"-=15px",left:"+=15px","font-size":"+=24px"},"slow",function(){$(this).fadeOut(500,function(){$(this).remove()})}),r.text(+r.text()-1?+r.text()-1:0),n.removeClass("title-liked")}else{var i=$(t('<span class="like-fade">+1</span>',{}));n.append(i),i.animate({top:"-=15px",left:"+=15px","font-size":"+=24px"},"slow",function(){$(this).fadeOut(500,function(){$(this).remove()})}),r.text(+r.text()+1),n.addClass("title-liked")}},error:function(e){var t=$.parseJSON(e.responseText).error_code;t===200101&&alert("你的动作太快了！")},dataType:"json"})}function i(e){var t=e.attr("data-operation"),n=t==="showImg";$.ajax({url:"/apis/group/user_config.json",type:"PUT",data:{is_show_image_list:n},success:function(t){n?window.location.reload():(e.parents(".gmain").find(".titles .title-imgs").hide(),e.attr("data-operation","showImg").text("展示缩略图"))},error:function(e){},dataType:"json"})}var s=function(){var e=$(".titles .title-img"),t=$(".titles .title-like");e.bind("click",function(e){e.preventDefault(),n($(this))}),ukey&&(t.bind("click",function(e){e.preventDefault(),r($(this))}),$(".gmain").delegate(".img-switch","click",function(e){e.preventDefault(),i($(this))}))};return s}),define("lib/jquery/easing",[],function(){jQuery.easing.jswing=jQuery.easing.swing,jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(e,t,n,r,i){return jQuery.easing[jQuery.easing.def](e,t,n,r,i)},easeInQuad:function(e,t,n,r,i){return r*(t/=i)*t+n},easeOutQuad:function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n},easeInOutQuad:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t+n:-r/2*(--t*(t-2)-1)+n},easeInCubic:function(e,t,n,r,i){return r*(t/=i)*t*t+n},easeOutCubic:function(e,t,n,r,i){return r*((t=t/i-1)*t*t+1)+n},easeInOutCubic:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t+n:r/2*((t-=2)*t*t+2)+n},easeInQuart:function(e,t,n,r,i){return r*(t/=i)*t*t*t+n},easeOutQuart:function(e,t,n,r,i){return-r*((t=t/i-1)*t*t*t-1)+n},easeInOutQuart:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t+n:-r/2*((t-=2)*t*t*t-2)+n},easeInQuint:function(e,t,n,r,i){return r*(t/=i)*t*t*t*t+n},easeOutQuint:function(e,t,n,r,i){return r*((t=t/i-1)*t*t*t*t+1)+n},easeInOutQuint:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t*t+n:r/2*((t-=2)*t*t*t*t+2)+n},easeInSine:function(e,t,n,r,i){return-r*Math.cos(t/i*(Math.PI/2))+r+n},easeOutSine:function(e,t,n,r,i){return r*Math.sin(t/i*(Math.PI/2))+n},easeInOutSine:function(e,t,n,r,i){return-r/2*(Math.cos(Math.PI*t/i)-1)+n},easeInExpo:function(e,t,n,r,i){return t==0?n:r*Math.pow(2,10*(t/i-1))+n},easeOutExpo:function(e,t,n,r,i){return t==i?n+r:r*(-Math.pow(2,-10*t/i)+1)+n},easeInOutExpo:function(e,t,n,r,i){return t==0?n:t==i?n+r:(t/=i/2)<1?r/2*Math.pow(2,10*(t-1))+n:r/2*(-Math.pow(2,-10*--t)+2)+n},easeInCirc:function(e,t,n,r,i){return-r*(Math.sqrt(1-(t/=i)*t)-1)+n},easeOutCirc:function(e,t,n,r,i){return r*Math.sqrt(1-(t=t/i-1)*t)+n},easeInOutCirc:function(e,t,n,r,i){return(t/=i/2)<1?-r/2*(Math.sqrt(1-t*t)-1)+n:r/2*(Math.sqrt(1-(t-=2)*t)+1)+n},easeInElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i)==1)return n+r;o||(o=i*.3);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return-(u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o))+n},easeOutElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i)==1)return n+r;o||(o=i*.3);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return u*Math.pow(2,-10*t)*Math.sin((t*i-s)*2*Math.PI/o)+r+n},easeInOutElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i/2)==2)return n+r;o||(o=i*.3*1.5);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return t<1?-0.5*u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)+n:u*Math.pow(2,-10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)*.5+r+n},easeInBack:function(e,t,n,r,i,s){return s==undefined&&(s=1.70158),r*(t/=i)*t*((s+1)*t-s)+n},easeOutBack:function(e,t,n,r,i,s){return s==undefined&&(s=1.70158),r*((t=t/i-1)*t*((s+1)*t+s)+1)+n},easeInOutBack:function(e,t,n,r,i,s){return s==undefined&&(s=1.70158),(t/=i/2)<1?r/2*t*t*(((s*=1.525)+1)*t-s)+n:r/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+n},easeInBounce:function(e,t,n,r,i){return r-jQuery.easing.easeOutBounce(e,i-t,0,r,i)+n},easeOutBounce:function(e,t,n,r,i){return(t/=i)<1/2.75?r*7.5625*t*t+n:t<2/2.75?r*(7.5625*(t-=1.5/2.75)*t+.75)+n:t<2.5/2.75?r*(7.5625*(t-=2.25/2.75)*t+.9375)+n:r*(7.5625*(t-=2.625/2.75)*t+.984375)+n},easeInOutBounce:function(e,t,n,r,i){return t<i/2?jQuery.easing.easeInBounce(e,t*2,0,r,i)*.5+n:jQuery.easing.easeOutBounce(e,t*2-i,0,r,i)*.5+r*.5+n}})}),define("lib/scrollto",["lib/jquery/easing"],function(e){"use strict";function n(e){var t=window.scrollX||window.pageXOffset||document.documentElement.scrollLeft,n=window.scrollY||window.pageYOffset||document.documentElement.scrollTop,r=n+(window.innerHeight||document.documentElement.clientHeight),i=t+(window.innerWidth||document.documentElement.clientWidth),s=e.scrollLeft,o=e.scrollTop,u=s+(e.width||0),a=o+(e.height||0),f=!1,l=!1;if(s!=null&&s<t||u>i)f=!0;if(o!=null&&o<n||a>r)l=!0;return f&&l?3:l?2:f?1:0}var t=$("html,body");return function(e,r,i,s){function h(){t.animate(a,l||1e3,"easeInOutCirc",r?function e(){e.exed&&r(),e.exed=!0}:null)}var o=typeof e=="number",u=o?{top:e,left:e}:e.offset?e.offset():e,a={},f,l,c;typeof i=="number"?(l=i,c=typeof s=="string"?s:"top"):typeof i=="string"?(l=1e3,c=i):(l=1e3,c=o?"top":"all");switch(c){case"all":a.scrollTop=u.top,a.scrollLeft=u.left;break;case"top":a.scrollTop=u.top;break;case"left":a.scrollLeft=u.left;break;default:return}e.jquery&&(a.width=e.width(),a.height=e.height()),f=n(a),e.jquery&&(delete a.width,delete a.height);switch(f){case 0:return r&&r(),!1;case 1:return delete a.scrollTop,h(),!0;case 2:return delete a.scrollLeft,h(),!0;case 3:return h(),!0;default:}}}),define("lib/G",[],function(){"use strict";var e=!!document.all&&navigator.userAgent.indexOf("Opera")===-1,t=e&&!("maxHeight"in document.body.style),n=e&&"prototype"in Image,r=e&&!t&&!n,i=window,s=i.document,o={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"};return{ua:{isIE:e,isIE6:t,isIE8:n,isIE7:r,isFF:!!s.getBoxObjectFor||"mozInnerScreenX"in i,isOP:!!i.opera&&!!i.opera.toString().indexOf("Opera"),isOP9:/^function \(/.test([].sort),isWK:!!i.devicePixelRatio,isCR:/s/.test(/a/.toString),isIpad:/iPad/.test(navigator.userAgent),isIphone:/iPhone/.test(navigator.userAgent)},isHtml:function(e){var t=/^[^<]*(<[\w\W]+>)[^>]*$/;return t.test(e)},format:function(e,t,n){if(typeof t=="string"){var r=n?t:"{v}",i=n||t;return e.replace(r,""+i)}var s=t,i;return e.replace(/\{([^{}]+)\}/g,function(e,t){return i=s[t],i!==undefined?""+i:""})},each:function(e,t,n){var r,i,s,o=Array.prototype.forEach,u=Object.prototype.hasOwnProperty;n=n||this;if(e==null)return;if(o&&e.forEach===o)e.forEach(t,n);else if(e instanceof Array)for(i=0,s=e.length;i<s;i++)t.call(n,e[i],i,e);else for(var a in e)u.call(e,a)&&t.call(n,e[a],a,e)},scriptOnload:function(e,t){window.addEventListener?(e.addEventListener("load",t,!1),e.addEventListener("error",function(){t()},!1)):e.attachEvent("onreadystatechange",function(){var n=e.readyState;(n==="loaded"||n==="complete")&&t()})},loadScript:function(e,t){var n=s.createElement("script"),r=this.loadScript.head=this.loadScript.head||s.getElementsByTagName("head")[0];return this.scriptOnload(n,function(){t&&t.call(n);try{if(n.clearAttributes)n.clearAttributes();else for(var e in n)delete n[e]}catch(i){}r.removeChild(n)}),n.async=!0,n.src=e,r.insertBefore(n,r.firstChild)},type:function(e){return e==null?String(e):o[Object.prototype.toString.call(e)]||"object"},isFun:function(e){return this.type(e)==="function"},unique:function(e){if(e==null)return;e.sort();for(var t=1;t<e.length;t++)e[t-1]===e[t]&&e.splice(t--,1);return e}}}),define("lib/toolTip",["lib/scrollto","lib/G"],function(e,t){"use strict";var n='<div class="{klass}" style="position:absolute;z-index:{zIndex};">                    {msg}                    <b class="{klassArrow}" style="{pointBStyle}"><s class="{klassArrow}" style="{pointSStyle}"></s></b>                </div>',r={up:"left",down:"left",right:"top",left:"top"},i={up:"top:-20px;border-bottom-style:solid;",down:"bottom:-20px;border-top-style:solid;",right:"right:-20px;border-left-style:solid;",left:"left:-20px;border-right-style:solid;"},s={up:"top:-8px;left:-9px;border-bottom-style:solid;",down:"top:-10px;left:-9px;border-top-style:solid;",right:"top:-9px;left:-10px;border-left-style:solid;",left:"top:-9px;left:-8px;border-right-style:solid;"},o=function(o,u,a){function y(){g.css({top:l[0],left:l[1],width:d}),$("b",g).css(r[h],p),v.append(g)}function b(){g.remove(),a&&a()}var f=u.msg,l=u.position,c=$(u.coordinates),h=u.direction||"up",p=u.offset||0,d=u.width,v=$(o),m=v.offset(),g=$(t.format(n,{msg:f,direction:h,zIndex:u.zIndex||999,klass:u.klass||"tooltip",klassArrow:(u.klass||"tooltip")+"-"+h,pointSStyle:"position:absolute;border-width:9px;border-color:transparent;border-style:dashed;width:0;height:0;font-size:0;"+s[h],pointBStyle:"position:absolute;border-width:10px;border-color:transparent;border-style:dashed;width:0;height:0;font-size:0;"+i[h]}));return v.css("position","relative"),c.length&&(c=c.position(),l[0]+=c.top,l[1]+=c.left),y(),u.noscroll||e({top:l[0]+m.top+(h==="up"?-10:0),left:l[1]+m.left+(h==="left"?-10:0)}),{remove:b,$toolTip:g}};return o}),define("lib/nameCard",["lib/toolTip","lib/tmpl"],function(toolTip,tmpl){function init(e,t,n,r,i){e=e,options=t,elemData=n,where=r||g_page_name,options.isGroup?getGroupData(i):getUserData(i)}function userFocus(e){var e=e;e.ukey&&(e.ukey===window.ukey?e.isMe=!0:$.ajax({url:"/apis/community/relationship/follow.json?retrieve_type=is_following&ukey="+e.ukey,async:!1,success:function(t){e.isFollowing=t.result.is_following},dataType:"json"}));if(window.ukey){e.isMe?nameCardToolTip.$toolTip.find('a[data-operation="follow"]').remove():e.isFollowing&&nameCardToolTip.$toolTip.find('a[data-operation="follow"]').replaceWith('<a class="card-focus_complete-btn" data-operation="unfollow" href="javascript: void 0;" data-login="yes"><span>已关注</span></a>');var t=follow();t.bind(nameCardToolTip.$toolTip,e.ukey)}}function showTooltip(e,t){var n=$(container),r=elemData.triggerElem,i=$(window).height(),s=$(window).width(),o=elemData.triggerTopViewArea,u=elemData.triggerRightViewArea,a=r.offset().left,f=r.offset().top+30,l=parseInt(r.css("height")),c=parseInt(r.css("width")),h=[f+l+12,a],p=o>i/2?"down":"up",d=options.offset||10,v=options.width||300,m=options.klass||"name_card";isGroup=options.isGroup||!1,a>s/2&&s-u<v-20&&(h[1]=a-v+50,d=v-d-20);if(window.nameCardShowOrder===t){nameCardToolTip=toolTip(n,{msg:e.resultHtml,position:h,direction:p,offset:d,width:v,klass:m},function(){return!1});if(p==="up")nameCardToolTip.$toolTip.css({top:f,display:"block"});else if(p==="down"){var g=parseInt(nameCardToolTip.$toolTip.css("height"));nameCardToolTip.$toolTip.css({top:f-g-52,display:"block"})}if(isGroup){if(window.ukey){var y=follow();y.bind(nameCardToolTip.$toolTip)}}else userFocus(e)}}function getGroupData(e){window.groupInfoCache=window.groupInfoCache||{};var t=elemData.triggerElem.attr("data-group_id"),n={resultHtml:""};groupInfoCache[t]?(n.resultHtml=formatHtml(groupInfoCache[t]),showTooltip(n,e)):$.ajax({url:"/apis/group/group.json",data:{retrieve_type:"by_id",group_id:t},success:function(n){var n=n.result[0],r={};for(var i in n)r[i]=n[i];r.icon=n.icon.large,groupInfoCache[t]=r;if(!r.is_publicly_readable)return;$.ajax({url:"/apis/group/post.json",data:{retrieve_type:"digest_post_by_group",group_id:t,limit:3},success:function(n){groupInfoCache[t].digests=n.result;var r=formatHtml(groupInfoCache[t]),i={resultHtml:r};showTooltip(i,e)},dataType:"json"})},dataType:"json"})}function getUserData(e){window.userInfoCache=window.userInfoCache||{};var t="",n="",r={resultHtml:"",ukey:"",isFollowing:!1,isMe:!1};if(elemData.ukey)t=elemData.ukey,r.ukey=elemData.ukey,n="/apis/community/user/"+t+".json";else{if(!elemData.nickname)return r.resultHtml=notExistHtml,showTooltip(r,e),!1;t=elemData.nickname,n="/apis/community/user.json?retrieve_type=by_nickname&nickname="+t}/^group/.test(where)?(r.resultHtml=nameCardHtml+groupFootmark,userInfoCache[t]?(r.resultHtml=formatHtml(userInfoCache[t],r.resultHtml),showTooltip(r,e)):$.ajax({url:n,success:function(t){var n=t.result;t.result.hasOwnProperty("ukey")||n[decodeURI(elemData.nickname)]&&n[decodeURI(elemData.nickname)].hasOwnProperty("ukey")?(r.ukey=n.ukey||n[decodeURI(elemData.nickname)].ukey,elemData.ukey?userInfoCache[r.ukey]=n:elemData.nickname&&(userInfoCache[r.ukey]=n[decodeURI(elemData.nickname)]),$.ajax({url:"/apis/group/user_info.json?ukey="+r.ukey,success:function(t){var n=t.result;for(var i in n)userInfoCache[r.ukey][i]=n[i];r.resultHtml=formatHtml(userInfoCache[r.ukey],r.resultHtml),showTooltip(r,e)},error:function(){r.resultHtml=notExistHtml,showTooltip(r,e)},dataType:"json"})):(r.resultHtml=notExistHtml,showTooltip(r,e))},error:function(){r.resultHtml=notExistHtml,showTooltip(r,e)},dataType:"json"})):/^ask/.test(where)?(r.resultHtml=nameCardHtml+askFootmark,userInfoCache[t]?(r.resultHtml=formatHtml(userInfoCache[t],r.resultHtml),showTooltip(r,e)):$.ajax({url:n,success:function(t){var n=t.result;t.result.hasOwnProperty("ukey")||n[decodeURI(elemData.nickname)]&&n[decodeURI(triggerElemData.nickname)].hasOwnProperty("ukey")?(r.ukey=n.ukey||n[decodeURI(elemData.nickname)].ukey,elemData.ukey?userInfoCache[r.ukey]=n:elemData.nickname&&(userInfoCache[r.ukey]=n[decodeURI(elemData.nickname)]),r.resultHtml=formatHtml(userInfoCache[r.ukey],r.resultHtml),showTooltip(r,e)):(r.resultHtml=notExistHtml,showTooltip(r,e))},error:function(){r.resultHtml=notExistHtml,showTooltip(r,e)},dataType:"json"})):where==="site"&&(r.resultHtml=nameCardHtml+siteFootMark,userInfoCache[t]?(r.resultHtml=formatSiteHtml(userInfoCache[t],r.resultHtml),showTooltip(r,e)):$.ajax({url:n,success:function(t){var n=t.result;t.result.hasOwnProperty("ukey")||n[decodeURI(elemData.nickname)]&&n[decodeURI(triggerElemData.nickname)].hasOwnProperty("ukey")?(r.ukey=n.ukey||n[decodeURI(elemData.nickname)].ukey,elemData.ukey?userInfoCache[r.ukey]=n:elemData.nickname&&(userInfoCache[r.ukey]=n[decodeURI(elemData.nickname)]),$.ajax({url:"/apis/minisite/article.json?retrieve_type=by_ukey&limit=3&ukey="+r.ukey,success:function(t){var n=t.result;userInfoCache[r.ukey]._new_articles=n,r.resultHtml=formatSiteHtml(userInfoCache[r.ukey],r.resultHtml),showTooltip(r,e)},error:function(){r.resultHtml=notExistHtml,showTooltip(r,e)},dataType:"json"})):(r.resultHtml=notExistHtml,showTooltip(r,e))},error:function(){r.resultHtml=notExistHtml,showTooltip(r,e)},dataType:"json"}))}function formatHtml(e,t){var n=e.level==="active"?'class="super-group-name"':"";if(!options.isGroup){var r="";e.introduction&&e.introduction.length>65&&(e.introduction=e.introduction.substr(0,65)+"...");if(e.admin_group&&e.admin_group.length>0){var i='<a href="<%=url%>"><%=title%></a>，';r+="<p>管理的小组：";for(var s=0;s<e.admin_group.length;s++)r+=tmpl(i,{url:e.admin_group[s][1],title:e.admin_group[s][0]});r=r.substr(0,r.length-1),r+="</p>"}var o=tmpl(userAchieveHtml,{badge_counts_gold:e.badge_counts.gold,badge_counts_silver:e.badge_counts.silver,badge_counts_copper:e.badge_counts.copper}),u="";e.is_title_authorized?e.master_category=="personal"?u=tmpl('<a class="gicon-sai" target="_blank" title="果壳达人:<%=title%>" href="http://www.guokr.com/nuts/"><img src="http://1.im.guokr.com/o_X5yS7UmXDrVaVY6rS9okvDxGAW1z_78zIzmqp7g00eAAAAHgAAAFBO.png"/></a>',{title:e.title}):u=tmpl('<a class="gicon-sai" target="_blank" title="果壳达人:<%=title%>" href="http://www.guokr.com/nuts/"><img src="http://2.im.guokr.com/s6h5XcQvWG5rd9CxUV7ulxf7N_NvqmGhYQKpsHMltVMeAAAAHgAAAFBO.png"/></a>',{title:e.title}):u="";var a=tmpl(userNutHtml,{is_title_authorized:u});userFollow=tmpl(userFollowHtml,{followings_count:e.followings_count,followings_url:e.url+"followings/",followers_count:e.followers_count,followers_url:e.url+"followers/"}),t=tmpl(t,{url:e.url,avatar_normal:e.avatar.normal,nickname:e.nickname,title:tmpl("<%=title%><%:=br%>",{title:e.title.trim()?e.title:"",br:e.title.trim()?"<br />":""}),userNut:a,nutKlass:n,achieveHtml:o,followHtml:userFollow,introduction:e.title.trim()?e.introduction.trim()?"简介："+e.introduction:"":e.introduction.trim()?"简介："+e.introduction:"简介：这家伙很懒，还没有写简介",posts_count:e.posts_count,digest_posts_count:e.digest_posts_count,post_replies_count:e.post_replies_count,admin_group:r,questions_count:e.questions_count,answers_count:e.answers_count,answer_supports_count:e.answer_supports_count})}else{e.introduction_summary&&e.introduction_summary.length>65&&(e.introduction_summary=e.introduction_summary.substr(0,65)+"...");if(e.is_application_required)var f=e.is_membership_applied?groupAppliedHtml:groupApplyHtml;else var f=e.is_member?groupUnfollowHtml:groupFollowHtml;followStr=tmpl(f,{memberNum:e.members_count,url:e.url,groupId:e.id}),groupAchieve=tmpl(groupAchieveHtml,{groupPostNum:e.posts_count});var l=e.level==="active"?tmpl('<a class="gicon-super" title="此小组处于高维空间，拥有更多功能与玩法" href="<%=url%>"></a>',{url:e.url}):"",t=tmpl(nameCardHtml,{avatar_normal:e.icon,nickname:e.name,nutKlass:n,achieveHtml:groupAchieve,userNut:l,followHtml:followStr,introduction:e.introduction_summary,title:"",url:e.url,groupId:e.id});digestsHtml="",digests=e.digests;if(digests){var c='<li class="gellipsis"><a href="<%=url%>"><%=title%></a></li>';for(var h=0;h<digests.length;h++){var p=digests[h];digestsHtml+=tmpl(c,{url:p.url,title:p.title})}var d=tmpl(groupFoot,{postDigests:digestsHtml});t+=d}}return t}function formatSiteHtml(e,t){var n="",r='<a href="<%=url%>"><%=title%></a><br/>',i=e._new_articles;if(i&&i.length>0){n+='<div class="card-footmark">                            <p class="card-footmark-tit"><span>主题站最新文章</span></p>                            <div class="card-footmark-info">';for(var s=0;s<i.length;s++)n+=tmpl(r,{url:i[s].url,title:i[s].title});n=n.substr(0,n.length-1),n+="</div></div>"}e.introduction&&e.introduction.length>65&&(e.introduction=e.introduction.substr(0,65)+"...");var o=tmpl(userAchieveHtml,{badge_counts_gold:e.badge_counts.gold,badge_counts_silver:e.badge_counts.silver,badge_counts_copper:e.badge_counts.copper}),u="";e.is_title_authorized?e.master_category=="personal"?u=tmpl('<a class="gicon-sai" target="_blank" title="果壳达人:<%=title%>" href="http://www.guokr.com/nuts/"><img src="http://1.im.guokr.com/o_X5yS7UmXDrVaVY6rS9okvDxGAW1z_78zIzmqp7g00eAAAAHgAAAFBO.png"/></a>',{title:e.title}):u=tmpl('<a class="gicon-sai" target="_blank" title="果壳达人:<%=title%>" href="http://www.guokr.com/nuts/"><img src="http://2.im.guokr.com/s6h5XcQvWG5rd9CxUV7ulxf7N_NvqmGhYQKpsHMltVMeAAAAHgAAAFBO.png"/></a>',{title:e.title}):u="";var a=tmpl(userNutHtml,{is_title_authorized:u});return userFollow=tmpl(userFollowHtml,{followings_count:e.followings_count,followings_url:e.url+"followings/",followers_count:e.followers_count,followers_url:e.url+"followers/"}),t=tmpl(t,{url:e.url,avatar_normal:e.avatar.normal,nickname:e.nickname,title:tmpl("<%=title%><%:=br%>",{title:e.title.trim()?e.title:"",br:e.title.trim()?"<br />":""}),userNut:a,nutKlass:"",achieveHtml:o,followHtml:userFollow,introduction:e.title.trim()?e.introduction.trim()?"简介："+e.introduction:"":e.introduction.trim()?"简介："+e.introduction:"简介：这家伙很懒，还没有写简介",site_articles:n}),t}function follow(){return{mouseEvents:function(e){function t(e){e.removeClass().addClass("card-focus_cancel-btn").html("<span>取消</span>")}function n(e){if(options.isGroup)var t="<span>已加入</span>";else var t="<span>已关注</span>";e.removeClass().addClass("card-focus_complete-btn").html(t)}e.delegate(".card-focus_complete-btn","mouseenter",function(){t($(this))}),e.delegate(".card-focus_cancel-btn","mouseleave",function(){n($(this))})},followApi:function(e,t,n){$.ajax({url:"/apis/community/relationship/follow.json",data:{ukey_following:e},type:t,success:function(e){e.ok&&n&&n()},dataType:"json"})},joinApi:function(id,type,cb){$.ajax({url:"/apis/group/member.json",data:{group_id:id},type:type,success:function(e){e.ok&&cb&&cb()},error:function(data){var json=eval("("+data.responseText+")");json.error_code==241001?alert("该小组不存在"):json.error_code==241016?alert("你不是这个小组的成员"):json.error_code==241017?alert("你是这个小组的管理员，不能退出"):json.error_code==241014&&alert("你在这个小组的黑名单里，不能加入")},dataType:"json"})},doFollow:function(e,t){var n=this,r=e.data("operation");if(options.isGroup){var i=r==="join"?"post":"delete",s=e.data("id");this.joinApi(s,i,function(){i==="post"?e.replaceWith(tmpl('<a class="card-focus_complete-btn" data-operation="unjoin" href="javascript: void 0;" data-login="yes" data-id="<%=id%>"><span>已加入</span></a>',{id:s})):e.replaceWith(tmpl('<a class="card-focus-btn" data-operation="join" href="javascript: void 0;" data-login="yes" data-id="<%=id%>"><span>加入</span></a>',{id:s}))})}else{var i=r==="follow"?"post":"delete";this.followApi(t,i,function(){i==="post"?e.replaceWith('<a class="card-focus_complete-btn" data-operation="unfollow" href="javascript: void 0;" data-login="yes"><span>已关注</span></a>'):e.replaceWith('<a class="card-focus-btn" data-operation="follow" href="javascript: void 0;" data-login="yes"><span>关注</span></a>')})}},bind:function(e,t){var n=this;(function(){e.delegate("a[data-operation]","click",function(){n.doFollow($(this),t)}),n.mouseEvents($(this))})()}}}var nameCardHtml='<div class="card-head">                    <a href="<%=url%>" class="card-user_pic"><img src="<%=avatar_normal%>" title="<%=nickname%>"></a>                    <div class="card-user_info">                        <div class="card-user_info-name">                            <a href="<%=url%>" <%:=nutKlass%> ><%=nickname%></a><%:=userNut%>                        </div>                        <div class="card-achieve-stat"><%:=achieveHtml%></div>                    </div>                </div>                <div class="card-focus"><%:=followHtml%></div>                <div class="card-desp"><%:=title%><%=introduction%></div>',userNutHtml='<span class="card-user_info-nuts"><%:=is_title_authorized%></span>',userAchieveHtml=' <span class="card-achieve-num"><i class="card-achieve-icon-gold icon-medal"></i><%=badge_counts_gold%></span>                            <span class="card-achieve-num"><i class="card-achieve-icon-silver icon-medal"></i><%=badge_counts_silver%></span>                            <span class="card-achieve-num"><i class="card-achieve-icon-copper icon-medal"></i><%=badge_counts_copper%></span>',groupAchieveHtml='<span class="card-achieve-small"><%=groupPostNum%>&nbsp;帖子</span>',userFollowHtml='<a href="javascript:void 0;" class="card-focus-btn" data-operation="follow" data-login="yes"><span>关注</span></a>                            <a href="<%=followings_url%>" class="card-focus-num">关注&nbsp;&nbsp;&nbsp;<span><%=followings_count%></span></a>|                            <a href="<%=followers_url%>" class="card-focus-num">被关注&nbsp;&nbsp;&nbsp;<span><%=followers_count%></span></a>',groupFollowHtml='<a href="javascript:void 0;" class="card-focus-btn" data-operation="join" data-login="yes" data-id="<%=groupId%>"><span>加入</span></a>                            <a href="<%=url%>members/" class="card-focus-num">成员&nbsp;&nbsp;&nbsp;<span><%=memberNum%></span></a>',groupUnfollowHtml='<a href="javascript:void 0;" class="card-focus_complete-btn" data-operation="quit" data-login="yes" data-id="<%=groupId%>"><span>已加入</span></a>                            <a href="<%=url%>members/" class="card-focus-num">成员&nbsp;&nbsp;&nbsp;<span><%=memberNum%></span></a>',groupApplyHtml='<a href="<%=url%>" class="card-focus-btn" data-login="yes"><span>申请</span></a>                        <a href="<%=url%>members/" class="card-focus-num">成员&nbsp;&nbsp;&nbsp;<span><%=memberNum%></span></a>',groupAppliedHtml='<span class="card-focus_complete-btn"><span>已加入</span></span>                            <a href="<%=url%>members/" class="card-focus-num">成员&nbsp;&nbsp;&nbsp;<span><%=memberNum%></span></a>',groupFootmark='<div class="card-footmark">                            <p class="card-footmark-tit"><span>小组足迹</span></p>                            <div class="card-footmark-info">                                <p>                                    发帖：<span><%=posts_count%></span>                                    精华：<span><%=digest_posts_count%></span>                                    回帖：<span><%=post_replies_count%></span>                                </p>                                <%:=admin_group%>                            </div>                        </div>',askFootmark='<div class="card-footmark">                            <p class="card-footmark-tit"><span>问答足迹</span></p>                            <div class="card-footmark-info">                                <p>                                    提问：<span><%=questions_count%></span>                                    回答：<span><%=answers_count%></span>                                    获得支持：<span><%=answer_supports_count%></span>                                </p>                            </div>                        </div>',groupFoot='<div class="card-footmark">                        <p class="card-footmark-tit"><span>最新精华帖</span></p>                        <ul class="card-footmark-info">                            <%:=postDigests%>                        </ul>                    </div>',siteFootMark="<%:=site_articles%>",notExistHtml='<div class="card-head">抱歉，该用户不在这个位面。</div>',nameCardToolTip=null,container="body",options={},elemData={},where="",showOrder=window.nameCardShowOrder||0,ukey=ukey,nameCard=function(e,t,n,r,i){init(e,t,n,r,i)};return nameCard}),define("lib/groupCard",["lib/nameCard"],function(e){function t(e,t,n,r){return function(){var i=e.attr("data-ukey")||"",s=e.attr("href").replace(/^(?:(?:http\:\/\/[a-z0-9\.]*)?guokr\.com(?:\:\d+)?)?\/n\/([^\/]*)\/$/,"$1")||"";window.nameCardShowOrder=window.nameCardShowOrder||0,r($(".gwrap"),{offset:10,isGroup:!0},{triggerElem:e,triggerTopViewArea:t,triggerRightViewArea:n,isGroup:!0},"group",window.nameCardShowOrder)}}return function(n){var r=null;n.delegate("a[data-group_id]","mouseenter",function(){var n=$(this),i=this.getBoundingClientRect().top,s=this.getBoundingClientRect().right;r=window.setTimeout(t(n,i,s,e),500)}),n.delegate("a[data-group_id]","mouseleave",function(){clearTimeout(r),r=setTimeout(function(){$(".name_card").remove(),window.nameCardShowOrder++},200),$(".name_card").hover(function(){clearTimeout(r)},function(){$(this).remove(),window.nameCardShowOrder++})})}}),define("lib/userCard",["lib/nameCard"],function(e){function t(e,t,n,r){return function(){var i=e.attr("data-ukey")||"",s=e.attr("href").replace(/^(?:(?:http\:\/\/[a-z0-9\.]*)?guokr\.com(?:\:\d+)?)?\/n\/([^\/]*)\/$/,"$1")||"";window.nameCardShowOrder=window.nameCardShowOrder||0,r($(".gwrap"),{offset:10},{ukey:i,nickname:s,triggerElem:e,triggerTopViewArea:t,triggerRightViewArea:n},"group",window.nameCardShowOrder)}}return function(n){var r=null;n.delegate('a[href*="/i/"][data-ukey]',"mouseenter",function(){var n=$(this),i=this.getBoundingClientRect().top,s=this.getBoundingClientRect().right;r=window.setTimeout(t(n,i,s,e),500)}),n.delegate('a[href*="/i/"][data-ukey]',"mouseleave",function(){clearTimeout(r),r=setTimeout(function(){$(".name_card").remove(),window.nameCardShowOrder++},200),$(".name_card").hover(function(){clearTimeout(r)},function(){$(this).remove(),window.nameCardShowOrder++})}),n.delegate('a[href*="/n/"]',"mouseenter",function(){if(/^(?:(?:http\:\/\/[a-z0-9\.]*)?guokr\.com(?:\:\d+)?)?\/n\/([^\/]*)\/$/.test($(this).attr("href"))){var n=$(this),i=this.getBoundingClientRect().top,s=this.getBoundingClientRect().right;r=window.setTimeout(t(n,i,s,e),500)}}),n.delegate('a[href*="/n/"]',"mouseleave",function(){/^(?:(?:http\:\/\/[a-z0-9\.]*)?guokr\.com(?:\:\d+)?)?\/n\/([^\/]*)\/$/.test($(this).attr("href"))&&(clearTimeout(r),r=setTimeout(function(){$(".name_card").remove(),window.nameCardShowOrder++},200),$(".name_card").hover(function(){clearTimeout(r)},function(){$(this).remove(),window.nameCardShowOrder++}))})}}),define("lib/support",["lib/G"],function(e){"use strict";var t=" -webkit- -moz- -o- -ms- -khtml- ".split(" "),n="Webkit Moz O ms Khtml".split(" "),r=document.createElement("div");return{fixed:function i(){if(typeof i.r!="undefined")return i.r;var t=!0;if(e.ua.isIpad||e.ua.isIphone)t=navigator.userAgent.match(/[5-9]_[0-9]/)!==null;else{var n=document.createElement("div"),r=document.createElement("div");n.style.position="absolute",n.style.top="200px",r.style.position="fixed",r.style.top="100px",n.appendChild(r),document.body.appendChild(n),r.getBoundingClientRect&&r.getBoundingClientRect().top==n.getBoundingClientRect().top&&(t=!1),document.body.removeChild(n),n=null,r=null}return i.r=t,t},touchEvent:function s(){if(typeof s.r!="undefined")return s.r;var e=!0,t=["touchstart","touchmove","touchend","touchcancel"];for(var n=0,i=t.length;n<i;n++){var o=t[n];o="on"+o;var u=o in r;u||(r.setAttribute(o,"return;"),u=typeof r[o]=="function");if(!u){e=!1;break}}return s.r=e,e},cssanimation:function o(){if(typeof o.r!="undefined")return o.r;var e=!1,t=r.style,i="animationName",s=i.charAt(0).toUpperCase()+i.substr(1),u=(i+" "+n.join(s+" ")+s).split(" ");for(var a in u)if(t[u[a]]!==undefined){e=!0;break}return o.r=e,e}}}),define("lib/Base",[],function(){"use strict";var e=function(){};return e.extend=function(e,t){var n=t||this;for(var r in n)n.hasOwnProperty(r)&&r!=="prototype"&&(e[r]=n[r]);for(var i in n.prototype)n.prototype.hasOwnProperty(i)&&(e.prototype[i]=n.prototype[i])},e}),define("lib/Event",["lib/Base"],function(e){"use strict";function o(){}var t=Array.prototype.slice,n=Object.prototype.toString,r=function(e){return typeof e=="object"?e===null?"null":/\[object (\w+)\]/.exec(n.call(e))[1].toLowerCase():typeof e},i=function(e,t,n){var i,s,o,u=Array.prototype.forEach;n=n||this;if(e==null)return;if(u&&e.forEach===u)e.forEach(t,n);else if(r(e)==="array")for(s=0,o=e.length;s<o;s++)t.call(n,e[s],s,e);else for(var a in e)ObjectProto.hasOwnProperty.call(e,a)&&t.call(n,e[a],a,e)},s=function(e,t,n){var i,s,o,u,a=Array.prototype.filter;n=n||this;if(e==null)return;if(a&&e.filter===a)return e.filter(t,n);if(r(e)==="array"){u=[];for(s=0,o=e.length;s<o;s++)t.call(n,e[s],s,e)&&u.push(e[s])}else{u={};for(var f in e)ObjectProto.hasOwnProperty.call(e,f)&&t.call(n,e[f],f,e)&&(u[f]=e[f])}return u};return o.prototype.on=function(e,t,n,r){return this.eventQueue=this.eventQueue||{},this.eventQueue[e]=this.eventQueue[e]||[],this.eventQueue[e].push({callback:t,context:n,once:r}),this},o.prototype.off=function(e,t){this.eventQueue=this.eventQueue||{};if(this.eventQueue[e]==null)return;return t?(this.eventQueue[e]=s(this.eventQueue[e],function(e,n){return e.callback!==t}),this.eventQueue[e].length===0&&delete this.eventQueue[e]):delete this.eventQueue[e],this},o.prototype.fire=function(e,n){this.eventQueue=this.eventQueue||{};var r=this.eventQueue[e],s=!0;if(r){var o=t.call(arguments,1);i(r,function(t){t.callback.apply(t.context,o)===!1&&(s=!1),t.once&&this.off(e,t.callback)},this)}return s},e.extend(o),o}),define("lib/Overlay",["lib/support","lib/Event","lib/G"],function(e,t,n){"use strict";function y(e){var t,n;e?(t=(u.height()-h.height())/2+(document.documentElement.scrollTop||window.pageYOffset||0),n=(u.width()-h.width())/2+(document.documentElement.scrollLeft||window.pageXOffset||0)):(t=(u.height()-h.height())/2,n=(u.width()-h.width())/2),h.css({top:t,left:n})}function b(e,t){v&&v.length&&v.css({opacity:e||.5,"background-color":t||"#000"}).show()}function w(){v&&v.length&&v.hide()}function E(){v.css({top:document.documentElement.scrollTop||window.pageYOffset||0,left:document.documentElement.scrollLeft||window.pageXOffset||0})}function S(){v.css({width:u.width(),height:u.height()})}function x(){n.ua.isIE6&&v&&v.length&&(v.css({position:"absolute",bottom:"auto",right:"auto"}),S(),E())}function T(t){if(T.inited)return;T.inited=!0,i=t||"gui",s='<div id="blockWindow" class="'+i+'-block">                           <div class="'+i+'-block-b">                               <h4 class="'+i+'-block-hd">                                   <span id="blockTitle"></span>                                   <a class="blockClose '+i+'-block-close" href="#" title="关闭">X</a>                               </h4>                               <div id="blockContent" class="'+i+'-block-bd"></div>                           </div>                       </div>',h=$(s),h.appendTo("body"),p=$(a),d=$(f),g=[h,p],navigator.userAgent.match(/iPad|iPhone/i)!==null?c=navigator.userAgent.match(/[5-9]_[0-9]/)!==null:(c=e.fixed(),u.resize(function(){m&&m.pos()})),n.ua.isIE6&&u.resize(function(){v&&v.length&&m&&S()}).scroll(function(){v&&v.length&&m&&E()}),h.delegate(l,"click",function(e){e.preventDefault(),m&&m.close()})}function N(e,t,n,r){this._isOpen=!1,T.call(this,r),this._fixed=c,this._coverNeedShowed=!1,this._initedCover=!1,e&&!r&&this.open(e,t,n)}var r=0,i,s='<div id="blockWindow" class="gui-block">                           <div class="gui-block-b">                               <h4 class="gui-block-hd">                                   <span id="blockTitle"></span>                                   <a class="blockClose gui-block-close" href="#" title="关闭">X</a>                               </h4>                               <div id="blockContent" class="gui-block-bd"></div>                           </div>                       </div>',o='<iframe src="{v}" id="blockIframe" frameborder="0" width="100%"></iframe>',u=$(window),a="#blockContent",f="#blockTitle",l=".blockClose",c,h,p,d,v,m,g;return N.prototype={openCallBack:function(e){return e&&this.on("open",e,this),this},closeCallBack:function(e){return e&&this.on("close",e,this),this},afterClose:function(e){return e&&this.on("afterClose",e,this),this},afterOpen:function(e){return e&&this.on("afterOpen",e,this),this},isOpen:function(){return this._isOpen},close:function(){return this._isOpen?this.fire("close",g)?(h.hide(),this._isOpen=!1,m=null,this.fire("afterClose",g),this):this:this},open:function(e,t,r){return this.fire("open",g)?(m&&m!==this&&m.close(),m=this,this.undelegate(),t&&this.delegate(t),e&&!n.isHtml(e)&&(e=n.format(o,e)),p.html(e||""),this._title&&d.html(this._title),this._width&&h.width(this._width),h.css("position",!this._fixed||!c?"absolute":"fixed"),this.pos(),h.show(),this._isOpen=!0,r&&r.call(this,p),this.fire("afterOpen",g),this):this},delegate:function(e){if(!e.length){p.delegate(e.selector,e.event,e.func);return}return n.each(e,function(e){this.delegate(e.selector,e.event,e.func)},p),this},undelegate:function(){return p.undelegate(),this},pos:function(){return y(!this._fixed||!c),n.ua.isIE6&&this._cover&&this._cover.length&&this._cover.css(),this},title:function(e){return this._title=e,this._isOpen&&d.html(e),this},width:function(e){return this._width=e,this._isOpen&&(h.width(e),this.pos()),this},pin:function(){if(this._fixed||!c)return;return this._fixed=!0,this._isOpen&&(h.css("position","fixed"),this.pos()),this},unpin:function(){if(!this._fixed)return;return this._fixed=!1,this._isOpen&&(h.css("position","absolute"),this.pos()),this},showCover:function(e,t){if(!v||!v.length)v=$('<div style="position:fixed;top:0;left:0;right:0;bottom:0;display:none;z-index:'+((parseInt(h.css("z-index"),10)||0)-1)+';"></div>').appendTo("body"),x();if(!this._initedCover){var n=this;this.on("afterClose",function(){n._coverNeedShowed&&w()}).on("afterOpen",function(){n._coverNeedShowed&&b(n._coverOpacity,n._coverColor)}),this._initedCover=!0}return typeof e=="string"&&(t=e,e=null),e&&(this._coverOpacity=e),t&&(this._coverColor=t),b(e||this._coverOpacity,t||this._coverColor),this._coverNeedShowed=!0,this},hideCover:function(){return w(),this._coverNeedShowed=!1,this}},t.extend(N),N}),define("lib/Anime",["lib/support"],function(e){"use strict";return{addCssString:function(e){var t=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(t),t.setAttribute("type","text/css"),t.styleSheet?t.styleSheet.cssText=e:t.innerHTML+=e},loading:function(e){e.jquery||(e=$(e))},flipping:function(t,n,r,i){function u(){i&&i(t)}n=n||500,r=r||0;var s=".flip-container {                        -webkit-perspective: 1000;                        -moz-perspective: 1000;                        -o-perspective: 1000;                        perspective: 1000;                    }                    .gui-anime-flipping {                        -webkit-transform: rotateY(180deg);                        -moz-transform: rotateY(180deg);                        -o-transform: rotateY(180deg);                        transform: rotateY(180deg);                    }                    .flipper {                        -webkit-transition: <t>s;                        -webkit-transform-style: preserve-3d;                        -moz-transition: <t>s;                        -moz-transform-style: preserve-3d;                        -o-transition: <t>s;                        -o-transform-style: preserve-3d;                        transition: <t>s;                        transform-style: preserve-3d;                        position: relative;                    }                    .front, .back {                        -webkit-backface-visibility: hidden;                        -moz-backface-visibility: hidden;                        -o-backface-visibility: hidden;                        backface-visibility: hidden;                        position: absolute;                        top: 0;                        left: 0;                    }                    .front {                        z-index: 2;                    }                    .back {                        -webkit-transform: rotateY(180deg);                        -moz-transform: rotateY(180deg);                        -o-transform: rotateY(180deg);                        transform: rotateY(180deg);                }";if(!e.cssanimation()){t.children(":visible").fadeOut(n/2,function(){$(this).siblings().fadeIn(n/2)}),i&&i(t);return}if(!this.flippingCssAdded){try{this.addCssString(G.format(s,{t:n/1e3,d:r/1e3},/<([^<>]+)>/g))}catch(o){i&&i(t);return}this.flippingCssAdded=!0}t.find(".hide").removeClass("hide"),t.hasClass("gui-anime-flipping")?(t.removeClass("gui-anime-flipping"),setTimeout(function(){t.find(".back").addClass("hide")},n/2)):(t.addClass("gui-anime-flipping"),setTimeout(function(){t.find(".front").addClass("hide")},n/2)),setTimeout(u,n+r)},focusing:function(t,n,r,i){function o(){t.removeClass("gui-anime-focusing"),n&&n(t)}if(!e.cssanimation()){n&&n(t);return}r=r||500,i=i||0;if(!this.focusingCssAdded){try{this.addCssString(G.format("@-webkit-keyframes guiFocusing {                            0%{-webkit-transform: scale(4); opacity:0;}                            100%{-webkit-transform: scale(1); opacity:1;}                        }                        @-moz-keyframes guiFocusing {                            0%{-moz-transform: scale(4); opacity:0;}                            100%{-moz-transform: scale(1); opacity:1;}                        }                        @-o-keyframes guiFocusing {                            0%{-o-transform: scale(4); opacity:0;}                            100%{-o-transform: scale(1); opacity:1;}                        }                        @-ms-keyframes guiFocusing {                            0%{-ms-transform: scale(4); opacity:0;}                            100%{-ms-transform: scale(1); opacity:1;}                        }                        @keyframes guiFocusing {                            0%{transform: scale(4); opacity:0;}                            100%{transform: scale(1); opacity:1;}                        }                        .gui-anime-focusing {                            -webkit-animation-name: guiFocusing;                            -webkit-animation-duration: <t>s;                            -webkit-animation-delay: <d>s;                            -webkit-animation-timing-function: ease-out;                            -moz-animation-name: guiFocusing;                            -moz-animation-duration: <t>s;                            -moz-animation-delay: <d>s;                            -moz-animation-timing-function: ease-out;                            animation-name: guiFocusing;                            animation-duration: <t>s;                            animation-delay: <d>s;                            animation-timing-function: ease-out;                        }",{t:r/1e3,d:i/1e3},/<([^<>]+)>/g))}catch(s){n&&n(t);return}this.focusingCssAdded=!0}t.addClass("gui-anime-focusing"),setTimeout(o,r+i)},shaking:function(t,n,r,i){function o(){t.removeClass("gui-anime-shaking"),t.removeClass("gui-anime-shaking-inline"),n&&n(t)}if(!e.cssanimation()){n&&n(t);return}r=r||500,i=i||0;if(!this.shakingCssAdded){try{this.addCssString(G.format("@-webkit-keyframes guiShaking {                            0% { -webkit-transform: translate(2px, 1px) rotate(0deg);transform: translate(2px, 1px) rotate(0deg); }                            10% { -webkit-transform: translate(-1px, -2px) rotate(-1deg);transform: translate(-1px, -2px) rotate(-1deg); }                            20% { -webkit-transform: translate(-3px, 0px) rotate(1deg);transform: translate(-3px, 0px) rotate(1deg); }                            30% { -webkit-transform: translate(0px, 2px) rotate(0deg);transform: translate(0px, 2px) rotate(0deg); }                            40% { -webkit-transform: translate(1px, -1px) rotate(1deg);transform: translate(1px, -1px) rotate(1deg); }                            50% { -webkit-transform: translate(-1px, 2px) rotate(-1deg);transform: translate(-1px, 2px) rotate(-1deg); }                            60% { -webkit-transform: translate(-3px, 1px) rotate(0deg);transform: translate(-3px, 1px) rotate(0deg); }                            70% { -webkit-transform: translate(2px, 1px) rotate(-1deg);transform: translate(2px, 1px) rotate(-1deg); }                            80% { -webkit-transform: translate(-1px, -1px) rotate(1deg);transform: translate(-1px, -1px) rotate(1deg); }                            90% { -webkit-transform: translate(2px, 2px) rotate(0deg);transform: translate(2px, 2px) rotate(0deg); }                            100% { -webkit-transform: translate(1px, -2px) rotate(-1deg);transform: translate(1px, -2px) rotate(-1deg); }                          }                          @-moz-keyframes guiShaking {                            0% { -moz-transform: translate(2px, 1px) rotate(0deg);transform: translate(2px, 1px) rotate(0deg); }                            10% { -moz-transform: translate(-1px, -2px) rotate(-1deg);transform: translate(-1px, -2px) rotate(-1deg); }                            20% { -moz-transform: translate(-3px, 0px) rotate(1deg);transform: translate(-3px, 0px) rotate(1deg); }                            30% { -moz-transform: translate(0px, 2px) rotate(0deg);transform: translate(0px, 2px) rotate(0deg); }                            40% { -moz-transform: translate(1px, -1px) rotate(1deg);transform: translate(1px, -1px) rotate(1deg); }                            50% { -moz-transform: translate(-1px, 2px) rotate(-1deg);transform: translate(-1px, 2px) rotate(-1deg); }                            60% { -moz-transform: translate(-3px, 1px) rotate(0deg);transform: translate(-3px, 1px) rotate(0deg); }                            70% { -moz-transform: translate(2px, 1px) rotate(-1deg);transform: translate(2px, 1px) rotate(-1deg); }                            80% { -moz-transform: translate(-1px, -1px) rotate(1deg);transform: translate(-1px, -1px) rotate(1deg); }                            90% { -moz-transform: translate(2px, 2px) rotate(0deg);transform: translate(2px, 2px) rotate(0deg); }                            100% { -moz-transform: translate(1px, -2px) rotate(-1deg);transform: translate(1px, -2px) rotate(-1deg); }                          }                          @keyframes guiShaking {                            0% { transform: translate(2px, 1px) rotate(0deg); }                            10% { transform: translate(-1px, -2px) rotate(-1deg); }                            20% { transform: translate(-3px, 0px) rotate(1deg); }                            30% { transform: translate(0px, 2px) rotate(0deg); }                            40% { transform: translate(1px, -1px) rotate(1deg); }                            50% { transform: translate(-1px, 2px) rotate(-1deg); }                            60% { transform: translate(-3px, 1px) rotate(0deg); }                            70% { transform: translate(2px, 1px) rotate(-1deg); }                            80% { transform: translate(-1px, -1px) rotate(1deg); }                            90% { transform: translate(2px, 2px) rotate(0deg); }                            100% { transform: translate(1px, -2px) rotate(-1deg); }                          }                          .gui-anime-shaking-inline,                          .gui-anime-shaking {                            display:block;                            position: relative;                            -webkit-animation-name: guiShaking;                            -webkit-animation-duration: <t>s;                            -webkit-animation-delay: <d>s;                            -webkit-transform-origin:50% 50%;                            -webkit-animation-iteration-count: 1;                            -webkit-animation-timing-function: linear;                            -moz-animation-name: guiShaking;                            -moz-animation-duration: <t>s;                            -moz-animation-delay: <d>s;                            -moz-transform-origin:50% 50%;                            -moz-animation-iteration-count: 1;                            -moz-animation-timing-function: linear;                            animation-name: guiShaking;                            animation-duration: <t>s;                            animation-delay: <d>s;                            transform-origin:50% 50%;                            animation-iteration-count: 1;                            animation-timing-function: linear;                          }                          .gui-anime-shaking-inline {                            display: inline-block;                        }",{t:r/1e3,d:i/1e3},/<([^<>]+)>/g))}catch(s){n&&n(t);return}this.shakingCssAdded=!0}t.css("display")==="inline"?t.addClass("gui-anime-shaking-inline"):t.addClass("gui-anime-shaking"),setTimeout(o,r+i)}}}),define("lib/Count",["lib/Anime"],function(e){"use strict";function n(e,n,r,i){var s=t.exec(e.text()),o;o=+s[2]+n,r!=null&&(o=Math.max(r,o)),i!=null&&(o=Math.min(i,o)),e.text(s?(s[1]||"")+o+(s[3]||""):"")}function r(e,n,r,i){var s=t.exec(e.text());r!=null&&(n=Math.max(r,n)),i!=null&&(n=Math.min(i,n)),e.text(s?(s[1]||"")+n+(s[3]||""):"")}var t=/([^\-0-9]+)?([\-0-9]+)([\w\W]+)?/;return function(t,i,s){var o=$(t);this.hasTarget=o.length>0,this.add=function(t,r){return n(o,t,i,s),r&&e[r](o),this},this.set=function(e){return r(o,e,i,s),this}}}),define("lib/placeholder",[],function(){"use strict";function t(e,t){var n=e.attr("type");if(e.val()==="")if(n!=="password")e.data("origColor",e.css("color")).val(t).css("color","#BBB");else{var r=parseInt(e.css("margin-right")),i=parseInt(e.css("border-right-width")),s=parseInt(e.css("padding-right")),o=e.width(),u=r+i+s+o,a=e.css("font-size"),f=e.outerHeight(),l=$('<span class="_input_placeholder">'+t+"</span>").insertAfter(e).css({color:"#BBB",fontSize:a,lineHeight:f+"px",height:f+"px",marginLeft:"-"+u+"px"});l.css("margin-right",u-l.width()+"px")}}function n(e,t){var n=e.attr("type"),r=e.val();n!=="password"&&r===t?e.val("").css("color",e.data("origColor")):n=="password"&&r===""&&e.next("span._input_placeholder").remove()}var e=document.createElement("textarea").placeholder==="";return{init:function(r){if(!e){var i=$(r),s=i.attr("placeholder");t(i,s),i.focus(function(){n(i,s)}).blur(function(){t(i,s)})}return this},submit:function(t,n,r){var i=$(t),s=$(n);return e?s.submit(r):s.submit(function(){var e=i.attr("placeholder"),t=i.val();return t===e&&i.val(""),r.apply(this,arguments)}),this},support:e}}),define("lib/groupJoin",["lib/Overlay","lib/Count","lib/placeholder"],function(Overlay,Count,placeholder){function joinHTML(e,t){return'<a class="delete" href="javascript:void 0;" data-id="'+e+'" data-method="'+t+'" data-operation="quit">已加入</a>'}function quitHTML(e,t,n,r){return'<a class="add" data-gaevent="group_join_button:group" href="javascript:void 0;" data-id="'+e+'" data-operation="'+t+'" data-method="'+n+'">'+r+"</a>"}function joinGroup(type,id,cb){$.ajax({url:"/apis/group/member.json",data:{group_id:id},type:type,success:function(e){e.ok&&cb&&cb()},error:function(data){var json=eval("("+data.responseText+")");json.error_code==241001?alert("该小组不存在"):json.error_code==241016?alert("你不是这个小组的成员"):json.error_code==241017?alert("你是这个小组的管理员，不能退出"):json.error_code==241014&&alert("你在这个小组的黑名单里，不能加入")},dataType:"json"})}function applyJoinGroup(e,t,n){$.ajax({url:"/apis/group/member_application.json",data:{group_id:t,annotation:e},type:"POST",success:function(e){e.ok&&n&&n()},dataType:"json"})}function groupJoin(e){var t=$(e.containerSelector||"body"),n=e.targetSelector||"a[data-operation]",r=e.numberSelector,i=e.parentsSelector||!0,s=e.join||joinHTML,o=e.quit||quitHTML,u=e.applyBlock||htmls.applyBlock,a=e.applied||htmls.applied;t.delegate(n,"click",function(){var n=$(this),f=n.data("operation"),l=n.attr("data-method"),c=n.attr("data-id"),h=l==="apply"?"申请":"+&nbsp;加入",p;r&&(i===!0?p=new Count(n.parent().find(r)):i===1?p=new Count(t.find(r)):p=new Count(n.parent(i).find(r))),f==="quit"||f==="unjoin"?joinGroup(type[f],c,function(){n.replaceWith(o(c,l,l,h)),p.hasTarget&&p.add(adds[f]),e.callback&&e.callback()}):f==="join"?joinGroup(type[f],c,function(){n.replaceWith(s(c,l)),p.hasTarget&&p.add(adds[f]),e.callback&&e.callback()}):block.open(u,null,function(){return block.title("加入这个小组需要申请哦，说说你的理由吧"),placeholder.init("#applyDetail"),$("#applyBtn").click(function(e){e.preventDefault();var t=$("#applyDetail"),r=t.val();applyTip=$(this).parent().prev(),placeholder.support||r===t.attr("placeholder")&&(t.val(""),r="");if(r.length>250)return applyTip.text(i18n.applyTextTooLong),!1;if(!r.length)return applyTip.text(i18n.applyEmpty),!1;applyJoinGroup(r,c,function(){block.close(),n.replaceWith(a)})}),!0})})}var htmls={applyBlock:'<div class="gui-block-apply">                            <textarea class="gttxt" placeholder="说点什么给管理员..." id="applyDetail"></textarea>                            <p class="fl" style="color:red"></p>                            <p class="fr">                                <a href="javascript: void 0;" class="gnbtn" id="applyBtn">提交</a>                                <a href="javascript: void 0;" class="blockClose">取消</a>                            </p>                         </div>',applied:'<span class="applied">已申请</span>'},i18n={applyTextTooLong:"申请理由不能超过250个字！",applyEmpty:"说点什么，让管理员了解你"},adds={join:1,quit:-1},type={join:"POST",quit:"DELETE"},block=new Overlay,joinOpts={rank:{containerSelector:".side-rank",numberSelector:"span.number"},groupList:{containerSelector:".group-list",targetSelector:".quitBtn,.joinBtn",numberSelector:".number",join:function(e,t){return'<a class="quitBtn"  href="javascript:void 0;" data-id="'+e+'" data-operation="quit" data-method="'+t+'"><span class="icon-ok">已加入</span></a>'},quit:function(e,t,n,r){return'<a class="joinBtn" data-gaevent="group_one_button_join:group" href="javascript:void 0;" data-id="'+e+'" data-operation="join" data-method="'+n+'">'+r+"</a>"}}};return function(){var e=[].slice.call(arguments),t=arguments.length,n;while(t--)typeof e[t]=="string"?(n=joinOpts[e[t]])&&groupJoin(n):typeof e[t]=="object"&&groupJoin(e[t])}}),require(["lib/user","lib/postList","lib/groupCard","lib/userCard","lib/groupJoin"],function(e,t,n,r,i){"use strict";var s=$(".gwrap"),o={login:function(){i("rank");var e=$(".side-rank"),t;e.delegate("a.delete","mouseenter mouseleave",function(e){var n=$(this),r=e.type;r==="mouseenter"?(clearTimeout(t),t=setTimeout(function(){n.addClass("hover").text("- 退出")},200)):r==="mouseleave"&&clearTimeout(t)}),e.delegate("a.hover","mouseleave",function(){var e=$(this);setTimeout(function(){e.removeClass("hover").text("已加入")},200)})},all:function(){t(),n(s),r(s)},unlogin:function(){}},u=e.isLogin()?"login":"unlogin";o[u]&&o[u](ukey),o.all&&o.all()}),define("index",function(){})})();